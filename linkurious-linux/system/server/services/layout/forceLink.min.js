"use strict";function forceLinkLayout(t,n,e){function i(t,n,e,i){return Math.sqrt((e-t)*(e-t)+(i-n)*(i-n))}function s(t,n,e,i,s){return(s-i)*(t-n)/(e-n)+i}function r(t){return Math.acos(t.x/Math.sqrt(t.x*t.x+t.y*t.y))}function o(t,n,e,i){return{xi:-(i-n),yi:e-t,xi_prime:i-n,yi_prime:-(e-t)}}function a(t,n){return{x:(t.xi_prime-t.xi)/n,y:(t.yi_prime-t.yi)/n}}function g(t,n,e,i,s){return{x:t+(e-t)*s,y:n+(i-n)*s}}function p(t,n){if(t%L.ppn!==0)throw new Error('Invalid argument in np: "i" is not correct ('+t+").");if(t!==parseInt(t))throw new TypeError('Invalid argument in np: "i" is not an integer.');if(n in w)return t+w[n];throw new Error("ForceLink.Worker - Inexistant node property given ("+n+").")}function h(t,n){switch(n.randomize){case"globally":return Math.random()*(n.randomizeFactor||1);case"locally":return t+Math.random()*(n.randomizeFactor||1);default:return t}}function d(){var t,n,e,h,d,u,l,c,f,M,b,x,w,S,q,I,k;for(e=0;e<L.nodesLength;e+=L.ppn)y[e+4]=y[e+2],y[e+5]=y[e+3],y[e+2]=0,y[e+3]=0;if(L.settings.outboundAttractionDistribution){for(f=0,e=0;e<L.nodesLength;e+=L.ppn)f+=y[e+6];f/=L.nodesLength}if(L.settings.barnesHutOptimize){var z,D,j=1/0,A=-(1/0),F=1/0,P=-(1/0);for(v=[],e=0;e<L.nodesLength;e+=L.ppn)j=Math.min(j,y[e]),A=Math.max(A,y[e]),F=Math.min(F,y[e+1]),P=Math.max(P,y[e+1]);for(v[0]=-1,v[1]=(j+A)/2,v[2]=(F+P)/2,v[3]=Math.max(A-j,P-F),v[4]=-1,v[5]=-1,v[6]=0,v[7]=0,v[8]=0,t=1,e=0;e<L.nodesLength;e+=L.ppn)for(n=0;;)if(v[n+5]>=0)z=y[e]<v[n+1]?y[e+1]<v[n+2]?v[n+5]:v[n+5]+L.ppr:y[e+1]<v[n+2]?v[n+5]+2*L.ppr:v[n+5]+3*L.ppr,v[n+7]=(v[n+7]*v[n+6]+y[e]*y[e+6])/(v[n+6]+y[e+6]),v[n+8]=(v[n+8]*v[n+6]+y[e+1]*y[e+6])/(v[n+6]+y[e+6]),v[n+6]+=y[e+6],n=z;else{if(v[n]<0){v[n]=e;break}if(v[n+5]=t*L.ppr,l=v[n+3]/2,c=v[n+5],v[c]=-1,v[c+1]=v[n+1]-l,v[c+2]=v[n+2]-l,v[c+3]=l,v[c+4]=c+L.ppr,v[c+5]=-1,v[c+6]=0,v[c+7]=0,v[c+8]=0,c+=L.ppr,v[c]=-1,v[c+1]=v[n+1]-l,v[c+2]=v[n+2]+l,v[c+3]=l,v[c+4]=c+L.ppr,v[c+5]=-1,v[c+6]=0,v[c+7]=0,v[c+8]=0,c+=L.ppr,v[c]=-1,v[c+1]=v[n+1]+l,v[c+2]=v[n+2]-l,v[c+3]=l,v[c+4]=c+L.ppr,v[c+5]=-1,v[c+6]=0,v[c+7]=0,v[c+8]=0,c+=L.ppr,v[c]=-1,v[c+1]=v[n+1]+l,v[c+2]=v[n+2]+l,v[c+3]=l,v[c+4]=v[n+4],v[c+5]=-1,v[c+6]=0,v[c+7]=0,v[c+8]=0,t+=4,z=y[v[n]]<v[n+1]?y[v[n]+1]<v[n+2]?v[n+5]:v[n+5]+L.ppr:y[v[n]+1]<v[n+2]?v[n+5]+2*L.ppr:v[n+5]+3*L.ppr,v[n+6]=y[v[n]+6],v[n+7]=y[v[n]],v[n+8]=y[v[n]+1],v[z]=v[n],v[n]=-1,D=y[e]<v[n+1]?y[e+1]<v[n+2]?v[n+5]:v[n+5]+L.ppr:y[e+1]<v[n+2]?v[n+5]+2*L.ppr:v[n+5]+3*L.ppr,z!==D){v[D]=e;break}n=z}}if(L.settings.barnesHutOptimize)for(M=L.settings.scalingRatio,e=0;e<L.nodesLength;e+=L.ppn)for(n=0;;)if(v[n+5]>=0){if(I=Math.sqrt((y[e]-v[n+7])*(y[e]-v[n+7])+(y[e+1]-v[n+8])*(y[e+1]-v[n+8])),2*v[n+3]/I<L.settings.barnesHutTheta){if(b=y[e]-v[n+7],x=y[e+1]-v[n+8],L.settings.adjustSizes?I>0?(k=M*y[e+6]*v[n+6]/I/I,y[e+2]+=b*k,y[e+3]+=x*k):I<0&&(k=-M*y[e+6]*v[n+6]/I,y[e+2]+=b*k,y[e+3]+=x*k):I>0&&(k=M*y[e+6]*v[n+6]/I/I,y[e+2]+=b*k,y[e+3]+=x*k),v[n+4]<0)break;n=v[n+4];continue}n=v[n+5]}else{if(v[n]>=0&&v[n]!==e&&(b=y[e]-y[v[n]],x=y[e+1]-y[v[n]+1],I=Math.sqrt(b*b+x*x),L.settings.adjustSizes?I>0?(k=M*y[e+6]*y[v[n]+6]/I/I,y[e+2]+=b*k,y[e+3]+=x*k):I<0&&(k=-M*y[e+6]*y[v[n]+6]/I,y[e+2]+=b*k,y[e+3]+=x*k):I>0&&(k=M*y[e+6]*y[v[n]+6]/I/I,y[e+2]+=b*k,y[e+3]+=x*k)),v[n+4]<0)break;n=v[n+4]}else for(M=L.settings.scalingRatio,h=0;h<L.nodesLength;h+=L.ppn)for(d=0;d<h;d+=L.ppn)b=y[h]-y[d],x=y[h+1]-y[d+1],L.settings.adjustSizes?(I=Math.sqrt(b*b+x*x)-y[h+8]-y[d+8],I>0?(k=M*y[h+6]*y[d+6]/I/I,y[h+2]+=b*k,y[h+3]+=x*k,y[d+2]+=b*k,y[d+3]+=x*k):I<0&&(k=100*M*y[h+6]*y[d+6],y[h+2]+=b*k,y[h+3]+=x*k,y[d+2]-=b*k,y[d+3]-=x*k)):(I=Math.sqrt(b*b+x*x),I>0&&(k=M*y[h+6]*y[d+6]/I/I,y[h+2]+=b*k,y[h+3]+=x*k,y[d+2]-=b*k,y[d+3]-=x*k));for(c=L.settings.gravity/L.settings.scalingRatio,M=L.settings.scalingRatio,e=0;e<L.nodesLength;e+=L.ppn)k=0,b=y[e],x=y[e+1],I=Math.sqrt(b*b+x*x),L.settings.strongGravityMode?I>0&&(k=M*y[e+6]*c):I>0&&(k=M*y[e+6]*c/I),y[e+2]-=b*k,y[e+3]-=x*k;for(M=1*(L.settings.outboundAttractionDistribution?f:1),u=0;u<L.edgesLength;u+=L.ppe)h=m[u],d=m[u+1],l=m[u+2],q=Math.pow(l,L.settings.edgeWeightInfluence),b=y[h]-y[d],x=y[h+1]-y[d+1],L.settings.adjustSizes?(I=Math.sqrt(b*b+x*x-y[h+8]-y[d+8]),L.settings.linLogMode?L.settings.outboundAttractionDistribution?I>0&&(k=-M*q*Math.log(1+I)/I/y[h+6]):I>0&&(k=-M*q*Math.log(1+I)/I):L.settings.outboundAttractionDistribution?I>0&&(k=-M*q/y[h+6]):I>0&&(k=-M*q)):(I=Math.sqrt(b*b+x*x),L.settings.linLogMode?L.settings.outboundAttractionDistribution?I>0&&(k=-M*q*Math.log(1+I)/I/y[h+6]):I>0&&(k=-M*q*Math.log(1+I)/I):L.settings.outboundAttractionDistribution?(I=1,k=-M*q/y[h+6]):(I=1,k=-M*q)),I>0&&(y[h+2]+=b*k,y[h+3]+=x*k,y[d+2]-=b*k,y[d+3]-=x*k);var O,E,R,_,H=0;if(L.settings.adjustSizes)for(e=0;e<L.nodesLength;e+=L.ppn)y[p(e,"pinned")]||(O=Math.sqrt(y[e+2]*y[e+2]+y[e+3]*y[e+3]),O>L.maxForce&&(y[e+2]=y[e+2]*L.maxForce/O,y[e+3]=y[e+3]*L.maxForce/O),E=y[e+6]*Math.sqrt((y[e+4]-y[e+2])*(y[e+4]-y[e+2])+(y[e+5]-y[e+3])*(y[e+5]-y[e+3])),R=Math.sqrt((y[e+4]+y[e+2])*(y[e+4]+y[e+2])+(y[e+5]+y[e+3])*(y[e+5]+y[e+3]))/2,_=.1*Math.log(1+R)/(1+Math.sqrt(E)),w=y[e],S=y[e+1],y[e]=y[e]+y[e+2]*(_/L.settings.slowDown),y[e+1]=y[e+1]+y[e+3]*(_/L.settings.slowDown),b=y[e],x=y[e+1],I=Math.sqrt((b-w)*(b-w)+(x-S)*(x-S)),H+=I);else for(e=0;e<L.nodesLength;e+=L.ppn)y[p(e,"pinned")]||(E=y[e+6]*Math.sqrt((y[e+4]-y[e+2])*(y[e+4]-y[e+2])+(y[e+5]-y[e+3])*(y[e+5]-y[e+3])),R=Math.sqrt((y[e+4]+y[e+2])*(y[e+4]+y[e+2])+(y[e+5]+y[e+3])*(y[e+5]+y[e+3]))/2,_=y[e+7]*Math.log(1+R)/(1+Math.sqrt(E)),y[e+7]=Math.min(1,Math.sqrt(_*(y[e+2]*y[e+2]+y[e+3]*y[e+3])/(1+Math.sqrt(E)))),w=y[e],S=y[e+1],y[e]=y[e]+y[e+2]*(_/L.settings.slowDown),y[e+1]=y[e+1]+y[e+3]*(_/L.settings.slowDown),b=y[e],x=y[e+1],I=Math.sqrt((b-w)*(b-w)+(x-S)*(x-S)),H+=I);if(L.iterations++,L.settings.autoStop&&(L.converged=L.iterations>L.settings.maxIterations||H/L.nodesLength<L.settings.avgDistanceThreshold,L.converged&&L.settings.alignNodeSiblings)){var T,W,G={},N={};for(u=0;u<L.edgesLength;u+=L.ppe)h=m[u],d=m[u+1],h!==d&&(G[h]=G[h]||{},G[d]=G[d]||{},G[h][d]=!0,G[d][h]=!0);Object.keys(G).forEach(function(t){t=~~t,W=Object.keys(G[t]),2==W.length&&(T=W[0]+";"+W[1],T in N?N[T].push(t):(T=W[1]+";"+W[0],N[T]||(N[T]=[~~W[1],~~W[0]]),N[T].push(t)))});var B,C,J,K,Q,U,V,X,Y,Z,$,tt,nt,et,it,st=L.settings.nodeSiblingsAngleMin;Object.keys(N).forEach(function(t){if(C=N[t].shift(),J=N[t].shift(),B=N[t].filter(function(t){return!y[p(t,"pinned")]}),1!=B.length){if(U=y[C],V=y[C+1],X=y[J],Y=y[J+1],K=Object.keys(G[C]).length,Q=Object.keys(G[J]).length,Z=s(K/(K+Q),0,1,.25,.75),tt=g(U,V,X,Y,Z),nt=o(U,V,X,Y),$=i(U,V,X,Y),et=a(nt,$),it=r(et),2*st>Math.PI)throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.");st>0&&(it<st||it>Math.PI-st&&it<=Math.PI?et={x:2*Math.cos(Math.PI-st),y:2*Math.sin(Math.PI-st)}:(it>2*Math.PI-st||it>=Math.PI&&it<Math.PI+st)&&(et={x:2*Math.cos(st),y:2*Math.sin(st)}));var n=0,e=1,h=1;B.length%2==1&&(h=0,n=1);for(var d=0;d<B.length;d++)y[B[d]]=tt.x+e*et.x*h*(n||d>=2?L.settings.nodeSiblingsScale:2*L.settings.nodeSiblingsScale/3),y[B[d]+1]=tt.y+e*et.y*h*(n||d>=2?L.settings.nodeSiblingsScale:2*L.settings.nodeSiblingsScale/3),e=-e,h+=(d+n)%2}})}}function u(t,n,e){var i={nodes:t,edges:n};for(l(i,e),x=!1;!L.converged;)d();return b(i),!0}function l(t,n){n=n||{};var e=M(t,n);y=e.nodes,m=e.edges,L.nodesLength=y.length,L.edgesLength=m.length,c(n)}function c(t){L.settings=f(t,L.settings)}function f(){var t,n,e={},i=arguments.length;for(t=i-1;t>=0;t--)for(n in arguments[t])e[n]=arguments[t][n];return e}function M(t,n){var e,i,s,r,o,a=t.nodes,g=t.edges,p={},d=new Float32Array(a.length*L.ppn),u=new Float32Array(g.length*L.ppe);for(e=i=0,s=a.length;e<s;e++,i+=L.ppn)r=a[e],p[r.id]=i,d[i]=h(r.x,n),d[i+1]=h(r.y,n),d[i+2]=0,d[i+3]=0,d[i+4]=0,d[i+5]=0,d[i+6]=1+(r.degree||0),d[i+7]=1,d[i+8]=r.size||n.defaultSize||1,d[i+9]=r.pinned||0;for(e=i=0,s=g.length;e<s;e++,i+=L.ppe)o=g[e],u[i]=p[o.source],u[i+1]=p[o.target],u[i+2]=o.weight||0;return{nodes:d,edges:u}}function b(t){for(var n=0,e=0,i=y.length;n<i;n+=L.ppn,++e){var s=t.nodes[e];s.pinned||(s.x=y[n],s.y=y[n+1])}}var y,m,v,x=!0,L={ppn:10,ppe:3,ppr:9,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:1,iterationsPerRender:1,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!0,alignNodeSiblings:!1,nodeSiblingsScale:1,nodeSiblingsAngleMin:0}},w={x:0,y:1,dx:2,dy:3,old_dx:4,old_dy:5,mass:6,convergence:7,size:8,pinned:9};u(t,n,e)}module.exports=forceLinkLayout;